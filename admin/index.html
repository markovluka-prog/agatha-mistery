<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | –ê–≥–∞—Ç–∞ –ú–∏—Å—Ç–µ—Ä–∏</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
        <div class="login-container">
            <div class="login-logo">
                <span class="logo-icon">üîê</span>
                <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
                <p>–°–∞–π—Ç —Ñ–∞–Ω–∞—Ç–æ–≤ –ê–≥–∞—Ç—ã –ú–∏—Å—Ç–µ—Ä–∏</p>
            </div>
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label for="password">–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="password" name="password" required
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="off">
                        <button type="button" id="toggle-password" class="toggle-password">
                            <span class="eye-icon">üëÅ</span>
                        </button>
                    </div>
                </div>
                <div id="login-error" class="login-error" hidden>
                    <span class="error-icon">‚ö†Ô∏è</span>
                    <span class="error-text"></span>
                </div>
                <button type="submit" id="login-btn" class="btn btn-primary btn-login">
                    –í–æ–π—Ç–∏
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="admin-panel" hidden>
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                <button id="logout-btn" class="btn-logout" title="–í—ã–π—Ç–∏">
                    <span>üö™</span>
                </button>
            </div>
            <nav class="sidebar-nav">
                <button class="nav-item active" data-section="quizzes">
                    <span class="nav-icon">üìù</span>
                    <span class="nav-text">–ö–≤–∏–∑—ã</span>
                </button>
                <button class="nav-item" data-section="places">
                    <span class="nav-icon">üìç</span>
                    <span class="nav-text">–ö–∞—Ä—Ç–∞</span>
                </button>
                <button class="nav-item" data-section="characters">
                    <span class="nav-icon">üë§</span>
                    <span class="nav-text">–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</span>
                </button>
                <button class="nav-item" data-section="moderation">
                    <span class="nav-icon">‚úÖ</span>
                    <span class="nav-text">–ú–æ–¥–µ—Ä–∞—Ü–∏—è</span>
                    <span id="moderation-badge" class="nav-badge" hidden>0</span>
                </button>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Save Indicator -->
            <div id="save-indicator" class="save-indicator" hidden>
                <span class="save-icon">üíæ</span>
                <span class="save-text">–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ</span>
            </div>

            <!-- Quizzes Section -->
            <section id="section-quizzes" class="content-section active">
                <div class="section-header">
                    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–≤–∏–∑–∞–º–∏</h2>
                    <button id="add-quiz-btn" class="btn btn-primary">
                        <span>+</span> –ù–æ–≤—ã–π –∫–≤–∏–∑
                    </button>
                </div>
                <div id="quizzes-list" class="items-grid">
                    <div class="loading-state">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </section>

            <!-- Places Section -->
            <section id="section-places" class="content-section">
                <div class="section-header">
                    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞–º–∏</h2>
                    <button id="add-place-btn" class="btn btn-primary">
                        <span>+</span> –ù–æ–≤—ã–π –º–∞—Ä–∫–µ—Ä
                    </button>
                </div>
                <div class="places-layout">
                    <div id="places-list" class="places-sidebar">
                        <div class="loading-state">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                    <div id="admin-map" class="admin-map"></div>
                </div>
            </section>

            <!-- Characters Section -->
            <section id="section-characters" class="content-section">
                <div class="section-header">
                    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏</h2>
                    <button id="add-character-btn" class="btn btn-primary">
                        <span>+</span> –ù–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂
                    </button>
                </div>
                <div id="characters-list" class="items-grid characters-grid">
                    <div class="loading-state">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </section>

            <!-- Moderation Section -->
            <section id="section-moderation" class="content-section">
                <div class="section-header">
                    <h2>–ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h2>
                </div>
                <div class="moderation-tabs">
                    <button class="tab-btn active" data-tab="reviews">
                        –í–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è <span id="reviews-count" class="tab-count">0</span>
                    </button>
                    <button class="tab-btn" data-tab="illustrations">
                        –ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ <span id="illustrations-count" class="tab-count">0</span>
                    </button>
                    <button class="tab-btn" data-tab="fanfics">
                        –§–∞–Ω—Ñ–∏–∫–∏ <span id="fanfics-count" class="tab-count">0</span>
                    </button>
                </div>
                <div id="moderation-content" class="moderation-content">
                    <div class="loading-state">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal Template -->
    <div id="modal-overlay" class="modal-overlay" hidden>
        <div class="modal">
            <div class="modal-header">
                <h3 id="modal-title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div id="modal-body" class="modal-body">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <!-- Quiz Editor Modal -->
    <div id="quiz-editor-modal" class="modal-overlay" hidden>
        <div class="modal modal-large">
            <div class="modal-header">
                <h3>–†–µ–¥–∞–∫—Ç–æ—Ä –∫–≤–∏–∑–∞</h3>
                <button class="modal-close" data-close="quiz-editor-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="quiz-form" class="editor-form">
                    <input type="hidden" id="quiz-id">
                    <div class="form-group">
                        <label for="quiz-title">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–≤–∏–∑–∞</label>
                        <input type="text" id="quiz-title" required placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                    </div>
                    <div class="form-group">
                        <label for="quiz-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="quiz-description" rows="2" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–≤–∏–∑–∞"></textarea>
                    </div>
                    <div class="questions-section">
                        <div class="questions-header">
                            <h4>–í–æ–ø—Ä–æ—Å—ã</h4>
                        </div>
                        <div id="questions-container" class="questions-container">
                            <!-- Questions will be rendered here -->
                        </div>
                        <button type="button" id="add-question-btn" class="btn btn-secondary btn-small" style="margin-top: 16px; width: 100%;">
                            + –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="delete-quiz-btn" class="btn btn-danger" hidden>–£–¥–∞–ª–∏—Ç—å</button>
                <div class="footer-right">
                    <button type="button" class="btn btn-secondary" data-close="quiz-editor-modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" id="save-quiz-btn" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Place Editor Modal -->
    <div id="place-editor-modal" class="modal-overlay" hidden>
        <div class="modal modal-large">
            <div class="modal-header">
                <h3>–†–µ–¥–∞–∫—Ç–æ—Ä –º–∞—Ä–∫–µ—Ä–∞</h3>
                <button class="modal-close" data-close="place-editor-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="place-form" class="editor-form">
                    <input type="hidden" id="place-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="place-name">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                            <input type="text" id="place-name" required placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="place-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="place-description" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="place-lat">–®–∏—Ä–æ—Ç–∞ (lat)</label>
                            <input type="number" id="place-lat" step="any" required placeholder="51.5074">
                        </div>
                        <div class="form-group">
                            <label for="place-lng">–î–æ–ª–≥–æ—Ç–∞ (lng)</label>
                            <input type="number" id="place-lng" step="any" required placeholder="-0.1278">
                        </div>
                    </div>
                    <p class="hint">–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</p>
                    <div id="place-editor-map" class="place-editor-map"></div>
                    <div class="form-group">
                        <label>–ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</label>
                        <div id="place-images-gallery" class="images-gallery">
                            <!-- Images will be rendered here -->
                        </div>
                        <div class="image-upload">
                            <input type="file" id="place-image-upload" accept="image/*" multiple>
                            <label for="place-image-upload" class="upload-btn">
                                <span>üì∑</span> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="delete-place-btn" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                <div class="footer-right">
                    <button type="button" class="btn btn-secondary" data-close="place-editor-modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" id="save-place-btn" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Character Editor Modal -->
    <div id="character-editor-modal" class="modal-overlay" hidden>
        <div class="modal">
            <div class="modal-header">
                <h3>–†–µ–¥–∞–∫—Ç–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h3>
                <button class="modal-close" data-close="character-editor-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="character-form" class="editor-form">
                    <input type="hidden" id="character-id">
                    <div class="form-group">
                        <label for="character-name">–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</label>
                        <input type="text" id="character-name" required placeholder="–ò–º—è">
                    </div>
                    <div class="form-group">
                        <label for="character-short">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                        <input type="text" id="character-short" placeholder="–û–¥–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ">
                    </div>
                    <div class="form-group">
                        <label for="character-bio">–ü–æ–ª–Ω–∞—è –±–∏–æ–≥—Ä–∞—Ñ–∏—è</label>
                        <textarea id="character-bio" rows="5" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞"></textarea>
                    </div>
                    <div class="form-group">
                        <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                        <div id="character-image-preview" class="image-preview">
                            <span class="placeholder">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>
                        </div>
                        <div class="image-upload">
                            <input type="file" id="character-image-upload" accept="image/*">
                            <label for="character-image-upload" class="upload-btn">
                                <span>üì∑</span> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="delete-character-btn" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                <div class="footer-right">
                    <button type="button" class="btn btn-secondary" data-close="character-editor-modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" id="save-character-btn" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Dialog -->
    <div id="confirm-dialog" class="modal-overlay" hidden>
        <div class="modal modal-small">
            <div class="modal-header">
                <h3 id="confirm-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
            </div>
            <div class="modal-body">
                <p id="confirm-message">–í—ã —É–≤–µ—Ä–µ–Ω—ã?</p>
            </div>
            <div class="modal-footer">
                <button type="button" id="confirm-cancel" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" id="confirm-ok" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="../js/supabase-config.js"></script>
    <script src="admin.js"></script>
</body>
</html>