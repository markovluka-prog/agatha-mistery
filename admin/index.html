<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>–ü–∞–Ω–µ–ª—å –î–µ—Ç–µ–∫—Ç–∏–≤–∞ | –ê–≥–∞—Ç–∞ –ú–∏—Å—Ç–µ—Ä–∏</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="admin.css?v=1.1">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Montserrat:wght@400;600&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-screen" >
        <div class="login-container glassmorphism">
            <div class="login-logo">
                <div class="mistery-eye">üëÅÔ∏è</div>
                <h1>Mistery Admin</h1>
                <p>–î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è —á–ª–µ–Ω–æ–≤ —à–∫–æ–ª—ã "–û–∫–æ –ò–Ω—Ç–µ—Ä–Ω–µ—à–Ω–ª"</p>
            </div>
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label for="password">–ü–∞—Ä–æ–ª—å</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="password" name="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                            autocomplete="off">
                        <button type="button" id="toggle-password" class="toggle-password">üëÅ</button>
                    </div>
                </div>
                <div id="login-error" class="login-error" hidden>
                    <span class="error-text">–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞</span>
                </div>
                <button type="submit" id="login-btn" class="btn btn-primary btn-full">–ü—Ä–æ–≤–µ—Ä–∫–∞</button>
            </form>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" hidden class="admin-panel">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="brand">
                    <span class="brand-eye">üëÅ</span>
                    <span class="brand-text">Mistery Panel</span>
                </div>
                <button id="logout-btn" class="btn-icon" title="–í—ã–π—Ç–∏">üö™</button>
            </div>

            <nav class="sidebar-nav">
                <button class="nav-item active" data-section="quizzes">
                    <span class="nav-icon">üìù</span>
                    <span class="nav-text">–ö–≤–∏–∑—ã</span>
                </button>
                <button class="nav-item" data-section="places">
                    <span class="nav-icon">üìç</span>
                    <span class="nav-text">–ö–∞—Ä—Ç–∞</span>
                </button>
                <button class="nav-item" data-section="characters">
                    <span class="nav-icon">üë§</span>
                    <span class="nav-text">–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</span>
                </button>
                <button class="nav-item" data-section="about">
                    <span class="nav-icon">‚ÑπÔ∏è</span>
                    <span class="nav-text">–û –Ω–∞—Å</span>
                </button>
                <button class="nav-item" data-section="moderation">
                    <span class="nav-icon">üïµÔ∏è</span>
                    <span class="nav-text">–ú–æ–¥–µ—Ä–∞—Ü–∏—è</span>
                    <span id="moderation-badge" class="nav-badge" hidden>0</span>
                </button>
            </nav>

            <div class="sidebar-footer">
                <div class="status-indicator">
                    <span class="dot online"></span>
                    <span>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∞</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Save Indicator -->
            <div id="save-indicator" class="save-indicator" hidden>
                <span class="save-icon">‚úÖ</span>
                <span class="save-text">–î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã</span>
            </div>

            <!-- Quizzes Section -->
            <section id="section-quizzes" class="content-section active">
                <div class="section-header">
                    <h2>–ö–≤–∏–∑—ã</h2>
                    <button id="add-quiz-btn" class="btn btn-gold">
                        + –°–æ–∑–¥–∞—Ç—å –∫–≤–∏–∑
                    </button>
                </div>
                <div id="quizzes-list" class="items-grid">
                    <div class="loading-state">–°–±–æ—Ä —É–ª–∏–∫...</div>
                </div>
            </section>

            <!-- Places Section -->
            <section id="section-places" class="content-section">
                <div class="section-header">
                    <h2>–ì–µ–æ–≥—Ä–∞—Ñ–∏—è –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π</h2>
                    <button id="add-place-btn" class="btn btn-gold">
                        + –ù–æ–≤—ã–π –º–∞—Ä–∫–µ—Ä
                    </button>
                </div>
                <div class="places-layout">
                    <div id="places-list" class="places-sidebar scrollbar-custom">
                        <div class="loading-state">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...</div>
                    </div>
                    <div id="admin-map" class="admin-map"></div>
                </div>
            </section>

            <!-- Characters Section -->
            <section id="section-characters" class="content-section">
                <div class="section-header">
                    <h2>–ê—Ä—Ö–∏–≤ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π</h2>
                    <button id="add-character-btn" class="btn btn-gold">
                        + –ù–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å
                    </button>
                </div>
                <div id="characters-list" class="items-grid characters-grid">
                    <div class="loading-state">–ü–æ–∏—Å–∫ –¥–æ—Å—å–µ...</div>
                </div>
            </section>

            <!-- About Section -->
            <section id="section-about" class="content-section">
                <div class="section-header">
                    <h2>–û –Ω–∞—Å</h2>
                    <button id="add-about-btn" class="btn btn-gold">
                        + –ù–æ–≤—ã–π –±–ª–æ–∫
                    </button>
                </div>
                <div id="about-list" class="items-grid">
                    <div class="loading-state">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</div>
                </div>
            </section>

            <!-- Moderation Section -->
            <section id="section-moderation" class="content-section">
                <div class="section-header">
                    <h2>–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—Å–∫–∞—è</h2>
                </div>
                <div class="moderation-tabs">
                    <button class="tab-btn active" data-tab="reviews">
                        –í–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è <span id="reviews-count" class="tab-count">0</span>
                    </button>
                    <button class="tab-btn" data-tab="illustrations">
                        –ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ <span id="illustrations-count" class="tab-count">0</span>
                    </button>
                    <button class="tab-btn" data-tab="fanfics">
                        –§–∞–Ω—Ñ–∏–∫–∏ <span id="fanfics-count" class="tab-count">0</span>
                    </button>
                </div>
                <div id="moderation-content" class="moderation-content scrollbar-custom">
                    <div class="loading-state">–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤...</div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <!-- Base Modal for generic info -->
    <div id="modal-overlay" class="modal-overlay" hidden>
        <div class="modal glassmorphism">
            <div class="modal-header">
                <h3 id="modal-title">–î–µ–ª–æ ‚Ññ...</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div id="modal-body" class="modal-body"></div>
        </div>
    </div>

    <!-- Quiz Editor Modal -->
    <div id="quiz-editor-modal" class="modal-overlay" hidden>
        <div class="modal modal-xl glassmorphism">
            <div class="modal-header">
                <h3>üìú –†–µ–¥–∞–∫—Ç–æ—Ä –∫–≤–∏–∑–∞</h3>
                <button class="modal-close" data-close="quiz-editor-modal">&times;</button>
            </div>
            <div class="modal-body scrollbar-custom">
                <form id="quiz-form" class="editor-form">
                    <input type="hidden" id="quiz-id">

                    <div class="field-pair">
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ (RU)</label>
                            <input type="text" id="quiz-title" required>
                        </div>
                        <div class="form-group">
                            <label>Title (EN)</label>
                            <input type="text" id="quiz-title-en">
                        </div>
                    </div>

                    <div class="field-pair">
                        <div class="form-group">
                            <label>–û–ø–∏—Å–∞–Ω–∏–µ (RU)</label>
                            <textarea id="quiz-description" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Description (EN)</label>
                            <textarea id="quiz-description-en" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="questions-section">
                        <div class="questions-header">
                            <h4>–°–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤</h4>
                        </div>
                        <div id="questions-container" class="questions-container"></div>
                        <button type="button" id="add-question-btn" class="btn btn-outline btn-full">
                            + –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="delete-quiz-btn" class="btn btn-danger-link" hidden>–£–¥–∞–ª–∏—Ç—å –∫–≤–∏–∑</button>
                <div class="footer-actions">
                    <button type="button" class="btn btn-text" data-close="quiz-editor-modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" id="save-quiz-btn" class="btn btn-gold">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Place Editor Modal -->
    <div id="place-editor-modal" class="modal-overlay" hidden>
        <div class="modal modal-xl glassmorphism">
            <div class="modal-header">
                <h3>üìç –¢–æ—á–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–µ</h3>
                <button class="modal-close" data-close="place-editor-modal">&times;</button>
            </div>
            <div class="modal-body scrollbar-custom">
                <form id="place-form" class="editor-form">
                    <input type="hidden" id="place-id">
                    <div class="field-pair">
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ (RU)</label>
                            <input type="text" id="place-name" required>
                        </div>
                        <div class="form-group">
                            <label>Name (EN)</label>
                            <input type="text" id="place-name-en">
                        </div>
                    </div>
                    <div class="field-pair">
                        <div class="form-group">
                            <label>–û–ø–∏—Å–∞–Ω–∏–µ (RU)</label>
                            <textarea id="place-description" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Description (EN)</label>
                            <textarea id="place-description-en" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="field-pair coords-row">
                        <div class="form-group">
                            <label>Lat (–®–∏—Ä–æ—Ç–∞)</label>
                            <input type="number" id="place-lat" step="any" required>
                        </div>
                        <div class="form-group">
                            <label>Lng (–î–æ–ª–≥–æ—Ç–∞)</label>
                            <input type="number" id="place-lng" step="any" required>
                        </div>
                    </div>
                    <div id="place-editor-map" class="place-editor-map"></div>

                    <div class="gallery-section">
                        <label>–ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã</label>
                        <div id="place-images-gallery" class="images-gallery"></div>
                        <div class="upload-wrapper">
                            <input type="file" id="place-image-upload" accept="image/*" multiple hidden>
                            <label for="place-image-upload" class="btn btn-outline btn-full">
                                üì∑ –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="delete-place-btn" class="btn btn-danger-link">–£–¥–∞–ª–∏—Ç—å –º–∞—Ä–∫–µ—Ä</button>
                <div class="footer-actions">
                    <button type="button" class="btn btn-text" data-close="place-editor-modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" id="save-place-btn" class="btn btn-gold">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Character Editor Modal -->
    <div id="character-editor-modal" class="modal-overlay" hidden>
        <div class="modal modal-lg glassmorphism">
            <div class="modal-header">
                <h3>üë§ –î–æ—Å—å–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h3>
                <button class="modal-close" data-close="character-editor-modal">&times;</button>
            </div>
            <div class="modal-body scrollbar-custom">
                <form id="character-form" class="editor-form">
                    <input type="hidden" id="character-id">
                    <div class="field-pair">
                        <div class="form-group">
                            <label>–ò–º—è (RU)</label>
                            <input type="text" id="character-name" required>
                        </div>
                        <div class="form-group">
                            <label>Name (EN)</label>
                            <input type="text" id="character-name-en">
                        </div>
                    </div>
                    <div class="field-pair">
                        <div class="form-group">
                            <label>–ö–æ—Ä–æ—Ç–∫–æ (RU)</label>
                            <input type="text" id="character-short">
                        </div>
                        <div class="form-group">
                            <label>Short (EN)</label>
                            <input type="text" id="character-short-en">
                        </div>
                    </div>
                    <div class="field-pair">
                        <div class="form-group">
                            <label>–ë–∏–æ–≥—Ä–∞—Ñ–∏—è (RU)</label>
                            <textarea id="character-bio" rows="6"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Bio (EN)</label>
                            <textarea id="character-bio-en" rows="6"></textarea>
                        </div>
                    </div>
                    <div class="image-section">
                        <label>–ü–æ—Ä—Ç—Ä–µ—Ç</label>
                        <div id="character-image-preview" class="image-preview">
                            <div class="portrait-placeholder">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                        </div>
                        <input type="file" id="character-image-upload" accept="image/*" hidden>
                        <label for="character-image-upload" class="btn btn-outline btn-full">
                            üì∑ –û–±–Ω–æ–≤–∏—Ç—å –ø–æ—Ä—Ç—Ä–µ—Ç
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="delete-character-btn" class="btn btn-danger-link">–£–¥–∞–ª–∏—Ç—å –∏–∑ –∞—Ä—Ö–∏–≤–∞</button>
                <div class="footer-actions">
                    <button type="button" class="btn btn-text" data-close="character-editor-modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" id="save-character-btn" class="btn btn-gold">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- About Editor Modal -->
    <div id="about-editor-modal" class="modal-overlay" hidden>
        <div class="modal modal-lg glassmorphism">
            <div class="modal-header">
                <h3>‚ÑπÔ∏è –ë–ª–æ–∫ "–û –Ω–∞—Å"</h3>
                <button class="modal-close" data-close="about-editor-modal">&times;</button>
            </div>
            <div class="modal-body scrollbar-custom">
                <form id="about-form" class="editor-form">
                    <input type="hidden" id="about-id">
                    <div class="field-pair">
                        <div class="form-group">
                            <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–¥–µ–ª–∞ (RU)</label>
                            <input type="text" id="about-title" required>
                        </div>
                        <div class="form-group">
                            <label>Section Title (EN)</label>
                            <input type="text" id="about-title-en">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>–ë–ª–æ–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)</label>
                        <div id="about-blocks-container" class="about-blocks-container">
                            <!-- Blocks will be added here dynamically -->
                        </div>
                        <button type="button" id="add-about-block-btn" class="btn btn-outline btn-full add-block-btn">
                            <span>+ –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫ (–ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ + —Ç–µ–∫—Å—Ç)</span>
                        </button>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label>–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</label>
                        <input type="number" id="about-sort" value="0">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="delete-about-btn" class="btn btn-danger-link">–£–¥–∞–ª–∏—Ç—å –±–ª–æ–∫</button>
                <div class="footer-actions">
                    <button type="button" class="btn btn-text" data-close="about-editor-modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" id="save-about-btn" class="btn btn-gold">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Dialog -->
    <div id="confirm-dialog" class="modal-overlay" hidden>
        <div class="modal modal-sm glassmorphism">
            <div class="modal-header">
                <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
            </div>
            <div class="modal-body">
                <p id="confirm-message">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ?</p>
            </div>
            <div class="modal-footer">
                <button type="button" id="confirm-cancel" class="btn btn-text">–ù–∞–∑–∞–¥</button>
                <button type="button" id="confirm-ok" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="../assets/scripts/config/supabase-config.js"></script>
    <script src="admin.js"></script>
</body>

</html>